<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>New Record State Extraction :: Debezium Documentation</title>
    <link rel="canonical" href="https://www.debezium.io/documentation/reference/stable/transformations/event-flattening.html">
    <meta name="generator" content="Antora 3.0.0-alpha.9">
<link rel="stylesheet" href="../../../debezium-antora/css/site.css">
<link rel="stylesheet" href="../../../debezium-antora/css/debezium-antora.css">
<link rel="stylesheet" href="../../../debezium-antora/css/highlightjs-dark.css">
<link rel="stylesheet" href="https://static.jboss.org/css/rhbar.css">
<script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.js"></script>
<script src="../../../debezium-antora/js/jquery.ba-floatingscrollbar.js"></script>
</head>
<body class="article">
<header class="header">
  <div id="rhbar">
      <a class="jbdevlogo" href="https://developers.redhat.com"></a>
      <a class="rhlogo" href="https://www.redhat.com"></a>
  </div>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
          <img src="/assets/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 14px;"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="/documentation/faq">FAQ</a>
        <a class="navbar-item" href="/documentation">DOCUMENTATION</a>
        <a class="navbar-item" href="/releases">RELEASES</a>
        <a class="navbar-item" href="/community">COMMUNITY</a>
        <a class="navbar-item" href="/blog">BLOG</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="reference" data-version="1.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Debezium Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorial.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../install.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../postgres-plugins.html">PostgreSQL Decoding Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../features.html">Features</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="avro.html">Avro Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="topic-routing.html">Topic Routing</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="event-flattening.html">New Record State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mongodb-event-flattening.html">MongoDB New Document State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="outbox-event-router.html">Outbox Event Router</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Connectors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/mysql.html">MySQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/mongodb.html">MongoDB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/postgresql.html">PostgreSQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/oracle.html">Oracle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/sqlserver.html">SQL Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/db2.html">Db2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/cassandra.html">Cassandra</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">API and SPI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/engine.html">Debezium Engine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/converters.html">Custom Converters</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/serdes.html">Change Event SerDes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/outbox.html">Outbox Quarkus Extension</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/cloudevents.html">CloudEvents</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/testcontainers.html">Integration Testing with Testcontainers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/openshift.html">Running on Openshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/embedded.html">Embedding Debezium</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Debezium Documentation</span>
    <span class="version">1.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Debezium Documentation</span>
      <ul class="versions">
        <li class="version">
          <a href="../../index.html">nightly</a>
        </li>
        <li class="version">
          <a href="../../dev/index.html">dev</a>
        </li>
        <li class="version">
          <a href="../../stable/index.html">stable</a>
        </li>
        <li class="version">
          <a href="../../1.5/index.html">1.5</a>
        </li>
        <li class="version">
          <a href="../../1.4/index.html">1.4</a>
        </li>
        <li class="version">
          <a href="../../1.3/index.html">1.3</a>
        </li>
        <li class="version">
          <a href="../../1.2/index.html">1.2</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../1.0/index.html">1.0</a>
        </li>
        <li class="version">
          <a href="../../0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="../../0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main" class="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../stable/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Debezium Documentation</a></li>
    <li>Configuration</li>
    <li><a href="event-flattening.html">New Record State Extraction</a></li>
  </ul>
</nav>
    <div class="page-versions-container">
    Version:
    <div class="page-versions">
        <button class="version-menu-toggle versions-menu-current" title="Show other versions of page">1.1</button>
        <!--<button class="version-menu-toggle versions-menu-select" title="Select other versions">Select</button>-->
        <div class="version-menu">
                <a class="version" href="../../transformations/event-flattening.html">nightly</a>
                <a class="version" href="../../dev/transformations/event-flattening.html">dev</a>
                <a class="version" href="../../stable/transformations/event-flattening.html">stable</a>
                <a class="version" href="../../1.5/configuration/event-flattening.html">1.5</a>
                <a class="version" href="../../1.4/configuration/event-flattening.html">1.4</a>
                <a class="version" href="../../1.3/configuration/event-flattening.html">1.3</a>
                <a class="version" href="../../1.2/configuration/event-flattening.html">1.2</a>
                <a class="version is-current" href="event-flattening.html">1.1</a>
                <a class="version" href="../../1.0/configuration/event-flattening.html">1.0</a>
                <a class="version" href="../../0.10/configuration/event-flattening.html">0.10</a>
                <a class="version" href="../../0.9/configuration/event-flattening.html">0.9</a>
        </div>
        |
    </div>
    </div>
  <div class="edit-this-page"><a href="https://github.com/uidoyen/debezium/edit/1.1/documentation/modules/ROOT/pages/configuration/event-flattening.adoc">Edit this Page</a></div>
  </div>
<div class="article-grid">
<div class="article-cell1">
<article class="doc">
        
    <div class="version-banner version-banner-outdated">
    You are viewing documentation for an outdated version of Debezium.
    <br/>
</div>            <h1 class="page">New Record State Extraction</h1>
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_change_event_structure">Change event structure</a></li>
<li><a href="#_behavior">Behavior</a></li>
<li><a href="#_configuration">Configuration</a></li>
<li><a href="#_adding_metadata">Adding metadata</a></li>
<li><a href="#_determine_original_operation_deprecated">Determine original operation  [DEPRECATED]</a></li>
<li><a href="#_adding_source_metadata_fields_deprecated">Adding source metadata fields [DEPRECATED]</a></li>
<li><a href="#configuration-options">Configuration options</a></li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This single message transformation (SMT) is supported for only the SQL database connectors. For the MongoDB connector, see the <a href="mongodb-event-flattening.html" class="page">documentation for the MongoDB equivalent to this SMT</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A Debezium data change event has a complex structure that provides a wealth of information. Kafka records that convey Debezium change events contain all of this information.
However, parts of a Kafka ecosystem might expect Kafka records that provide a flat structure of field names and values.
To provide this kind of record, Debezium provides the <code>ExtractNewRecordState</code> single message transformation (SMT). Configure this transformation when consumers need Kafka records that have a format that is simpler than Kafka records that contain Debezium change events.</p>
</div>
<div class="paragraph">
<p>The <code>ExtractNewRecordState</code> transformation is a
<a href="https://kafka.apache.org/documentation/#connect_transforms">Kafka Connect SMT</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_change_event_structure"><a class="anchor" href="#_change_event_structure"></a>Change event structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Debezium generates data change events that have a complex structure.
Each event consists of three parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Metadata, which includes but is not limited to:</p>
<div class="ulist">
<ul>
<li>
<p>The operation that made the change</p>
</li>
<li>
<p>Source information such as the names of the database and table where the change was made</p>
</li>
<li>
<p>Time stamp for when the change was made</p>
</li>
<li>
<p>Optional transaction information</p>
</li>
</ul>
</div>
</li>
<li>
<p>Row data before the change</p>
</li>
<li>
<p>Row data after the change</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the structure of an <code>UPDATE</code> change event looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
	"op": "u",
	"source": {
		...
	},
	"ts_ms" : "...",
	"before" : {
		"field1" : "oldvalue1",
		"field2" : "oldvalue2"
	},
	"after" : {
		"field1" : "newvalue1",
		"field2" : "newvalue2"
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>More details about change event structure are provided in
<a href="../connectors/index.html" class="page">the documentation for each connector</a>.</p>
</div>
<div class="paragraph">
<p>This complex format provides the most information about changes happening in the system.
However, other connectors or other parts of the Kafka ecosystem usually expect the data in a simple format like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
	"field1" : "newvalue1",
	"field2" : "newvalue2"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To provide the needed Kafka record format for consumers, configure the <code>ExtractNewRecordState</code> SMT.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_behavior"><a class="anchor" href="#_behavior"></a>Behavior</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>ExtractNewRecordState</code> SMT extracts the <code>after</code> field from a Debezium change event in a Kafka record. The SMT replaces the original change event with only its <code>after</code> field to create a simple Kafka record.</p>
</div>
<div class="paragraph">
<p>You can configure the <code>ExtractNewRecordState</code> SMT for a Debezium connector or for a sink connector that consumes messages emitted by a Debezium connector. The advantage of configuring <code>ExtractNewRecordState</code> for a sink connector is that records stored in Apache Kafka contain whole Debezium change events. The decision to apply the SMT to a source or sink connector depends on your particular use case.</p>
</div>
<div class="paragraph">
<p>You can configure the transformation to do any of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add metadata from the change event to the simplified Kafka record. The default behavior is that the SMT does not add metadata.</p>
</li>
<li>
<p>Keep Kafka records that contain change events for <code>DELETE</code> operations in the stream. The default behavior is that the SMT drops Kafka records for <code>DELETE</code> operation change events because most consumers cannot yet handle them.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A database <code>DELETE</code> operation causes Debezium to generate two Kafka records:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A record that contains <code>"op": "d",</code> the <code>before</code> row data, and some other fields.</p>
</li>
<li>
<p>A tombstone record that has the same key as the deleted row and a value of <code>null</code>. This record is a marker for Apache Kafka. It indicates that
<a href="https://kafka.apache.org/documentation/#compaction">log compaction</a> can remove all records that have this key.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Instead of dropping the record that contains the <code>before</code> row data, you can configure the <code>ExtractNewRecordData</code> SMT to do one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Keep the record in the stream and edit it to have only the <code>"value": "null"</code> field.</p>
</li>
<li>
<p>Keep the record in the stream and edit it to have a <code>value</code> field that contains the key/value pairs that were in the <code>before</code> field with an added <code>"__deleted": "true"</code> entry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Similary, instead of dropping the tombstone record, you can configure the <code>ExtractNewRecordData</code> SMT to keep the tombstone record in the stream.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configure the Debezium <code>ExtractNewRecordState</code> SMT in a Kafka Connect source or sink connector by adding the SMT configuration details to your connector&#8217;s configuration. To obtain the default behavior, in a <code>.properties</code> file, you would specify something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">transforms=unwrap,...
transforms.unwrap.type=io.debezium.transforms.ExtractNewRecordState</code></pre>
</div>
</div>
<div class="paragraph">
<p>As for any Kafka Connect connector configuration, you can set <code>transforms=</code> to multiple, comma-separated, SMT aliases in the order in which you want Kafka Connect to apply the SMTs.</p>
</div>
<div class="paragraph">
<p>The following <code>.properties</code> example sets several <code>ExtractNewRecordState</code> options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">transforms=unwrap,...
transforms.unwrap.type=io.debezium.transforms.ExtractNewRecordState
transforms.unwrap.drop.tombstones=false
transforms.unwrap.delete.handling.mode=rewrite
transforms.unwrap.add.fields=table,lsn</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>drop.tombstones=false</code></dt>
<dd>
<p>Keeps tombstone records for <code>DELETE</code> operations in the event stream.</p>
</dd>
<dt class="hdlist1"><code>delete.handling.mode=rewrite</code></dt>
<dd>
<p>For <code>DELETE</code> operations, edits the Kafka record by flattening the <code>value</code> field that was in the change event. The <code>value</code> field directly contains the key/value pairs that were in the <code>before</code> field. The SMT adds <code>__deleted</code> and sets it to <code>true</code>, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"value": {
  "pk": 2,
  "cola": null,
  "__deleted": "true"
}</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>add.fields=table,lsn</code></dt>
<dd>
<p>Adds change event metadata for the <code>table</code> and <code>lsn</code> fields to the simplified Kafka record.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_metadata"><a class="anchor" href="#_adding_metadata"></a>Adding metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>ExtractNewRecordState</code> SMT can add original, change event metadata to the simplified Kafka record. For example, you might want the simplified record&#8217;s header or value to contain any of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The type of operation that made the change</p>
</li>
<li>
<p>The name of the database or table that was changed</p>
</li>
<li>
<p>Connector-specific fields such as the Postgres LSN field</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on what is available see <a href="../connectors/index.html" class="page">the documentation for each connector</a>.</p>
</div>
<div class="paragraph">
<p>To add metadata to the simplified Kafka record&#8217;s header, specify the <code>add.header</code> option.
To add metadata to the simplified Kafka record&#8217;s value, specify the <code>add.fields</code> option.
Each of these options takes a comma separated list of change event field names. Do not specify spaces. When there are duplicate field names, to add metadata for one of those fields, specify the struct as well as the field. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>transforms=unwrap,...
transforms.unwrap.type=io.debezium.transforms.ExtractNewRecordState
transforms.unwrap.add.fields=op,table,lsn,source.ts_ms
transforms.unwrap.add.headers=db
transforms.unwrap.delete.handling.mode=rewrite</pre>
</div>
</div>
<div class="paragraph">
<p>With that configuration, a simplified Kafka record would contain something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
 ...
	"__op" : "c",
	"__table": "MY_TABLE",
	"__lsn": "123456789",
	"__source_ts_ms" : "123456789",
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, simplified Kafka records would have a <code>__db</code> header.</p>
</div>
<div class="paragraph">
<p>In the simplified Kafka record, the SMT prefixes the metadata field names with a double underscore. When you specify a struct, the SMT also inserts an underscore between the struct name and the field name.</p>
</div>
<div class="paragraph">
<p>To add metadata to a simplified Kafka record that is for a <code>DELETE</code> operation, you must also configure <code>delete.handling.mode=rewrite</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_determine_original_operation_deprecated"><a class="anchor" href="#_determine_original_operation_deprecated"></a>Determine original operation  [DEPRECATED]</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>The <code>operation.header</code> option is deprecated and scheduled for removal. Please use add.headers instead. If both add.headers and operation.header are specified, the latter will be ignored.</em></p>
</div>
<div class="paragraph">
<p>When a Kafka record is flattened the final result won&#8217;t show whether it was an insert, update or first read
(deletions can be detected via tombstones or rewrites, see <a href="#options-for-configuring-extractnewrecordstate-transformation">Configuration options</a>).</p>
</div>
<div class="paragraph">
<p>To solve this problem Debezium offers an option to propagate the original operation via a header added to the Kafka record.
To enable this feature the option <code>operation.header</code> must be set to <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">transforms=unwrap,...
transforms.unwrap.type=io.debezium.transforms.ExtractNewRecordState
transforms.unwrap.operation.header=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The possible values are the ones from the <code>op</code> field of the original change event.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_source_metadata_fields_deprecated"><a class="anchor" href="#_adding_source_metadata_fields_deprecated"></a>Adding source metadata fields [DEPRECATED]</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>The <code>add.source.fields</code> option is deprecated and scheduled for removal. Please use add.fields instead. If both add.fields and add.source.fields are specified, the latter will be ignored.</em></p>
</div>
<div class="paragraph">
<p>The SMT can optionally add metadata fields from the original change event&#8217;s <code>source</code> structure to the final flattened record (prefixed with "__"). This functionality can be used to add things like the table from the change event, or connector-specific fields like the Postgres LSN field. For more information on what&#8217;s available in the source structure see <a href="../connectors/index.html" class="page">the documentation for each connector</a>.</p>
</div>
<div class="paragraph">
<p>For example, the configuration</p>
</div>
<div class="listingblock">
<div class="content">
<pre>transforms=unwrap,...
transforms.unwrap.type=io.debezium.transforms.ExtractNewRecordState
transforms.unwrap.add.source.fields=table,lsn</pre>
</div>
</div>
<div class="paragraph">
<p>will add</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{ "__table": "MY_TABLE", "__lsn": "123456789", ...}</pre>
</div>
</div>
<div class="paragraph">
<p>to the final flattened record.</p>
</div>
<div class="paragraph">
<p>For <code>DELETE</code> events, this option is only supported when the <code>delete.handling.mode</code> option is set to "rewrite".</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-options"><a class="anchor" href="#configuration-options"></a>Configuration options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following table describes the options that you can specify for the <code>ExtractNewRecordState</code> SMT.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 25%;">
<col style="width: 45%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Property</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#extract-new-record-state-drop-tombstones"><code>drop.tombstones</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>true</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Debezium generates a tombstone record for each <code>DELETE</code> operation. The default behavior is that <code>ExtractNewRecordState</code> removes tombstone records from the stream. To keep tombstone records in the stream, specify <code>drop.tombstones=false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#extract-new-record-state-delete-handling-mode"><code>delete.handling.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>drop</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Debezium generates a change event record for each <code>DELETE</code> operation. The default behavior is that <code>ExtractNewRecordState</code> removes these records from the stream. To keep Kafka records for <code>DELETE</code> operations in the stream, set <code>delete.handling.mode</code> to <code>none</code> or <code>rewrite</code>.<br>
<br>
Specify <code>none</code> to keep the change event record in the stream. The record contains only <code>"value": "null"</code>. <br>
<br>
Specify <code>rewrite</code> to keep the change event record in the stream and edit the record to have a <code>value</code> field that contains the key/value pairs that were in the <code>before</code> field and also add <code>__deleted: true</code> to the <code>value</code>. This is another way to indicate that the record has been deleted.<br>
<br>
When you  specify <code>rewrite</code>, the updated simplified records for <code>DELETE</code> operations might be all you need to track deleted records. You can consider accepting the default behavior of dropping the tombstone records that the Debezium connector creates.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#extract-new-record-state-route-by-field"><code>route.by.field</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>To use row data to determine the topic to route the record to, set this option to an <code>after</code> field attribute. The SMT routes the record to the topic whose name matches the value of the specified <code>after</code> field attribute. For a <code>DELETE</code> operation, set this option to a <code>before</code> field attribute.<br>
<br>
For example, configuration of <code>route.by.field=destination</code> routes records to the topic whose name is the value of <code>after.destination</code>. The default behavior is that a Debezium connector sends each change event record to a topic whose name is formed from the name of the database and the name of the table in which the change was made.<br>
<br>
If you are configuring the <code>ExtractNewRecordState</code> SMT on a sink connector, setting this option might be useful when the destination topic name dictates the name of the database table that will be updated with the simplified change event record. If the topic name is not correct for your use case, you can configure <code>route.by.field</code> to re-route the event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#extract-new-record-state-add-fields"><code>add.fields</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Set this option to a comma-separated list, with no spaces, of metadata fields to add to the simplified Kafka record&#8217;s value. When there are duplicate field names, to add metadata for one of those fields, specify the struct as well as the field, for example <code>source.ts_ms</code>.<br>
<br>
When the SMT adds metadata fields to the simplified record&#8217;s value, it prefixes each metadata field name with a double underscore. For a struct specification, the SMT also inserts an underscore between the struct name and the field name.<br>
<br>
If you specify a field that is not in the change event record, the SMT still adds the field to the record&#8217;s value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#extract-new-record-state-add-headers"><code>add.headers</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Set this option to a comma-separated list, with no spaces, of metadata fields to add to the header of the simplified Kafka record. When there are duplicate field names, to add metadata for one of those fields, specify the struct as well as the field, for example <code>source.ts_ms</code>.<br>
<br>
When the SMT adds metadata fields to the simplified record&#8217;s header, it prefixes each metadata field name with a double underscore. For a struct specification, the SMT also inserts an underscore between the struct name and the field name.<br>
<br>
If you specify a field that is not in the change event record, the SMT does not add the field to the header.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#extract-new-record-state-operation-header"><code>operation.header</code></a><br>
DEPRECATED</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>This option is deprecated and scheduled for removal. Please use add.headers instead. If both add.headers and operation.header are specified, the latter will be ignored.</em></p>
</div>
<div class="paragraph">
<p>The SMT adds the event operation (as obtained from the <code>op</code> field of the original record) as a Kafka record header.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#extract-new-record-state-add-source-fields"><code>add.source.fields</code></a><br>
DEPRECATED</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>This option is deprecated and scheduled for removal. Please use add.fields instead. If both add.fields and add.source.fields are specified, the latter will be ignored.</em></p>
</div>
<div class="paragraph">
<p>Fields from the change event&#8217;s <code>source</code> structure to add as metadata (prefixed with "__") to the flattened record.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</article>
</div>
<div class="article-cell2">
</div>
</div>

<div id="toc-rightbar"></div>    <footer class="footer">
        <div class="wrapper">
            <div class="copyright">Copyright &copy; 2021 Debezium Community</div>
        </div>
    </footer>
</main>
</div>
<script>
    /* Make sure TOC carets are expanded if sub-elements exist */
    $("#toc").each(function(i,v) {
      $(this).closest('article').addClass('with-toc');
    });

    $("#toc ul.sectlevel1 > li").each(function(i,v) {
      $(this).has("ul").addClass("expanded");
    });

    $(function() {
        /* Expands all the documentation submenus */
        $(".nav-list > .nav-item:not(.is-active) .nav-item-toggle").click();
    });

    /**
     * This checks if a "#toc" element exists in the DOM and if so:
     *
     *  1. Appends a cloned copy of the #toc node to the #toc-rightbar div.
     *  2. Forces the #toc-rightbar div to be visible.
     *  3. Adds the .toc-right class to the #article-wrapper div to restrict the article's overall width.
     */
    var $toc = $("#toc");
    if ( $toc.length ) {
        $("#toc-rightbar").append($toc.clone());
        $("body .main").addClass("with-toc");
    }

    /**
     * In order to make CSS changes that are backward compatible with old adoc files, this applies a version
     * style to the body tag so we can use it to differentiate between CSS styles per version if needed,
     * such as tfoot rows.
     */
    var $version = $("body .nav-container").data("version");
    var $versionClass = "version-" + $version;
    $versionClass = $versionClass.replace('.','-');
    $("body").addClass($versionClass);

    /** A CSS trick to wrap long-width tables in a div that can be scrolled on smaller screens */
    $("table.tableblock").wrap("<div class='table-scroll-wrapper'></div>");

    $(function() {
        /* apply floating scrollbar to the scroll-wrapper */
        $(".table-scroll-wrapper").floatingScrollbar();
    });

</script>
<script src="../../../debezium-antora/js/site.js"></script>
<script async src="../../../debezium-antora/js/vendor/highlight.js"></script>

<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-10656779-1");
    pageTracker._trackPageview();
  } catch(err) {}
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76464546-1', 'auto');
  ga('send', 'pageview');
  ga('set', 'anonymizeIp', true);
  ga('require', 'linkid', 'linkid.js');
</script>
</body>
</html>