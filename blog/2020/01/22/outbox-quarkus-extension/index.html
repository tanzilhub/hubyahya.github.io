<!DOCTYPE html>
<html>

<head>
  <title>Outbox Event Router goes Supersonic!</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong.">
  <link rel="alternate" type="application/rss+xml" title="Debezium Blog" href="/blog.atom">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/assets/css/custom.css" />
  
</head>

<body class="post">
  <div id="rhbar">
  <a class="jbdevlogo" href="https://developers.redhat.com"></a>
  <a class="rhlogo" href="https://www.redhat.com/"></a>
</div>

  <div id>
    <div class="container" id="content">
      <nav class="navbar navbar-inverse navbar-fix">
  <div class="container-fluid">
    <div class="navbar-header">
      <button class="navbar-toggle collapsed border-0" type="button" data-toggle="collapse" data-target="#navigation"
        aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><img class="project-logo" src="/assets/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 5px; margin-top: -5px;"></a>
    </div>
    <div class="collapse navbar-collapse collapsed" id="navigation">
      <ul class="nav navbar-nav pull-right">
        
            <li>
          
          <a href="/documentation/faq" class="">FAQ</a>
        </li>
        
            <li class="item">
          
          <a href="/documentation/" class="">Documentation</a>
        </li>
        
            <li>
          
          <a href="/releases/" class="">Releases</a>
        </li>
        
            <li>
          
            <a href="/community/" class="">Community</a>
        </li>
        
          <li class="active">
            
          <a href="/blog/" class="active">Blog</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
        
          <div class="row post-text-padding row-no-expand">
  <!-- Sidebar -->
  <div class="col-md-3"><div id="leftdocnav">
  <div class="hidden-lg hidden-md hidden-sm">
    <button
      class="navbar-toggle docssubmenu-toggle collapsed"
      data-target="#docssubmenu"
      data-toggle="collapse"
      style="
        float: none;
        background-color: #656565;
        border-color: #656565;
        width: 100%;
        color: #fff;
      "
    >
      Navigation Menu
    </button>
  </div>
  <div class="collapse" id="docssubmenu">
    <div class="doc-pills">
      <ul class="nav nav-pills nav-stacked">
        <li class="item">
          <a href="/blog">Home</a>
          <div class="icon"><span class="icon-home"></span></div>
        </li>
        
          <li class="item">
        
          <a href="/archives">Archive</a>
          <div class="icon"><span class="icon-arrow-down"></span></div>
        </li>
        <li class="item">
          <a href="/blog.atom">Feed</a>
          <div class="icon"><span class="icon-rss"></span></div>
        </li>
      </ul>
    </div>
    <p></p>
    <div class="featured-posts">
      <div id="#featured" style="margin-bottom: 4px; border-bottom: 1px solid #ccc; font-size: 115%; margin-left: 2px;">Featured Posts</div>
        <ul style="padding-inline-start: 22px;">
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
            <li style="margin-bottom: 3px;">
              <a href="/blog/2020/11/04/streaming-vitess-at-bolt/" style="font-size: 95%;">
                Streaming Vitess at Bolt
              </a>
            </li>  
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
            <li style="margin-bottom: 3px;">
              <a href="/blog/2020/02/10/event-sourcing-vs-cdc/" style="font-size: 95%;">
                Distributed Data for Microservices â€” Event Sourcing vs. Change Data Capture
              </a>
            </li>  
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
            <li style="margin-bottom: 3px;">
              <a href="/blog/2019/10/01/audit-logs-with-change-data-capture-and-stream-processing/" style="font-size: 95%;">
                Building Audit Logs with Change Data Capture and Stream Processing
              </a>
            </li>  
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
            <li style="margin-bottom: 3px;">
              <a href="/blog/2019/07/12/streaming-cassandra-at-wepay-part-1/" style="font-size: 95%;">
                Streaming Cassandra at WePay - Part 1
              </a>
            </li>  
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
            <li style="margin-bottom: 3px;">
              <a href="/blog/2019/02/19/reliable-microservices-data-exchange-with-the-outbox-pattern/" style="font-size: 95%;">
                Reliable Microservices Data Exchange With the Outbox Pattern
              </a>
            </li>  
            
          
            
          
            
          
            
          
            
          
            
          
            
            <li style="margin-bottom: 3px;">
              <a href="/blog/2018/12/05/automating-cache-invalidation-with-change-data-capture/" style="font-size: 95%;">
                Automating Cache Invalidation With Change Data Capture
              </a>
            </li>  
            
          
            
          
            
          
            
            <li style="margin-bottom: 3px;">
              <a href="/blog/2018/09/20/materializing-aggregate-views-with-hibernate-and-debezium/" style="font-size: 95%;">
                Materializing Aggregate Views With Hibernate and Debezium
              </a>
            </li>  
            
          
            
          
            
          
            
          
            
          
            
            <li style="margin-bottom: 3px;">
              <a href="/blog/2018/07/19/advantages-of-log-based-change-data-capture/" style="font-size: 95%;">
                Five Advantages of Log-Based Change Data Capture
              </a>
            </li>  
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
            <li style="margin-bottom: 3px;">
              <a href="/blog/2018/03/08/creating-ddd-aggregates-with-debezium-and-kafka-streams/" style="font-size: 95%;">
                Creating DDD aggregates with Debezium and Kafka Streams
              </a>
            </li>  
            
          
            
          
            
          
            
          
            
            <li style="margin-bottom: 3px;">
              <a href="/blog/2018/01/17/streaming-to-elasticsearch/" style="font-size: 95%;">
                Streaming Data Changes from Your Database to Elasticsearch
              </a>
            </li>  
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        </ul>
    </div>
    <p></p>
    <p></p>
    <div class="cloud-tags">
      <div id="tags" style="margin-bottom: 4px; border-bottom: 1px solid #ccc; font-size: 115%; margin-left: 2px;"> Tags
      </div>
        <div class="tag-cloud"> 
          
          
          <span class="site-tag">
            <a href="/tag/apache-kafka/" style="font-size: 88%">
              apache kafka
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/apicurio/" style="font-size: 82%">
              apicurio
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/avro/" style="font-size: 84%">
              avro
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/aws/" style="font-size: 82%">
              aws
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/camel/" style="font-size: 82%">
              camel
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/cassandra/" style="font-size: 134%">
              cassandra
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/community/" style="font-size: 102%">
              community
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/cqrs/" style="font-size: 82%">
              cqrs
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/db2/" style="font-size: 114%">
              db2
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/debezium-server/" style="font-size: 86%">
              debezium server
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/discussion/" style="font-size: 114%">
              discussion
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/docker/" style="font-size: 182%">
              docker
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/ebezium-server/" style="font-size: 82%">
              ebezium server
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/elasticsearch/" style="font-size: 82%">
              elasticsearch
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/event-sourcing/" style="font-size: 82%">
              event sourcing
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/example/" style="font-size: 88%">
              example
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/examples/" style="font-size: 102%">
              examples
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/fedora/" style="font-size: 82%">
              fedora
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/integration/" style="font-size: 82%">
              integration
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/introduction/" style="font-size: 84%">
              introduction
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/jaeger/" style="font-size: 82%">
              jaeger
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/json/" style="font-size: 82%">
              json
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/kafka/" style="font-size: 86%">
              kafka
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/kafka-streams/" style="font-size: 86%">
              kafka streams
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/kogito/" style="font-size: 82%">
              kogito
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/ksql/" style="font-size: 82%">
              ksql
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/kubernetes/" style="font-size: 82%">
              kubernetes
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/microservices/" style="font-size: 84%">
              microservices
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/mongodb/" style="font-size: 186%">
              mongodb
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/mysql/" style="font-size: 252%">
              mysql
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/news/" style="font-size: 100%">
              news
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/newsletter/" style="font-size: 86%">
              newsletter
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/oracle/" style="font-size: 150%">
              oracle
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/outbox/" style="font-size: 100%">
              outbox
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/postgres/" style="font-size: 222%">
              postgres
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/presentation/" style="font-size: 84%">
              presentation
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/production/" style="font-size: 82%">
              production
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/quarkus/" style="font-size: 90%">
              quarkus
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/rds/" style="font-size: 84%">
              rds
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/releases/" style="font-size: 236%">
              releases
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/schema/" style="font-size: 82%">
              schema
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/secrets/" style="font-size: 82%">
              secrets
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/sentry/" style="font-size: 82%">
              sentry
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/serialization/" style="font-size: 82%">
              serialization
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/smt/" style="font-size: 84%">
              smt
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/sql/" style="font-size: 84%">
              sql
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/sqlserver/" style="font-size: 170%">
              sqlserver
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/testcontainers/" style="font-size: 88%">
              testcontainers
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/topics/" style="font-size: 82%">
              topics
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/tracing/" style="font-size: 82%">
              tracing
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/vagrant/" style="font-size: 82%">
              vagrant
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/vitess/" style="font-size: 96%">
              vitess
            </a>
          </span>
          
          <span class="site-tag">
            <a href="/tag/website/" style="font-size: 84%">
              website
            </a>
          </span>
          
        </div>
  </div>
  </div>
</div>
</div>
  <div class="col-md-9">
    <div class="post">
      
      <div
        class="row"
        style="margin-left: 0; margin-right: 0; margin-bottom: 10px"
      >
        <div class="col-sm-12" style="padding-left: 0px">
          <div style="display: table-cell; vertical-align: top">
            <div
              style="
                width: 72px;
                border: 1px solid #ccc;
                padding: 3px;
                display: inline-block;
              "
            >
             
                  <img src="/assets/images/ccranfor.jpg" style="width: 64px;"> 
                
            </div>
          </div>
          <div style="display: table-cell; vertical-align: top">
            <div style="margin-left: 8px">
              <span
                class="hidden-sm hidden-xs"
                style="font-size: 2.75rem; line-height: 1"
              >
                <a href="/blog/2020/01/22/outbox-quarkus-extension/">Outbox Event Router goes Supersonic!</a>
              </span>
              <span
                class="hidden-md hidden-lg"
                style="font-size: 2rem; line-height: 1"
              >
                <a href="/blog/2020/01/22/outbox-quarkus-extension/">Outbox Event Router goes Supersonic!</a>
              </span>
              <div class="byline" style="line-height: 1">
                
                    
                    <em> January 22, 2020 by </em>
                    <em> Chris Cranford </em>
                <div class="hidden-xs" style="margin-top: 5px">
                  
                  <a
                    class="label label-info hidden-sm hidden-xs"
                    href="/tag/discussion/"
                    >discussion</a
                  >
                  
                  <a
                    class="label label-info hidden-sm hidden-xs"
                    href="/tag/examples/"
                    >examples</a
                  >
                  
                  <a
                    class="label label-info hidden-sm hidden-xs"
                    href="/tag/outbox/"
                    >outbox</a
                  >
                  
                  <a
                    class="label label-info hidden-sm hidden-xs"
                    href="/tag/quarkus/"
                    >quarkus</a
                  >
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="grid__item width-12-12"><div class="paragraph">
<p>Outbox as in that folder in my email client?
No, not exactly but there are some similarities!</p>
</div>
<div class="paragraph">
<p>The term outbox describes a pattern that allows independent components or services to perform <em>read your own write</em> semantics while concurrently providing a reliable, eventually consistent view to those writes across component or service boundaries.</p>
</div>
<div class="paragraph">
<p>You can read more about the Outbox pattern and how it applies to microservices in our blog post, <a href="/blog/2019/02/19/reliable-microservices-data-exchange-with-the-outbox-pattern/">Reliable Microservices Data Exchange With the Outbox Patttern</a>.</p>
</div>
<div class="paragraph">
<p>So what exactly is an Outbox Event Router?</p>
</div>
<div class="paragraph">
<p>In Debezium version 0.9.3.Final, we introduced a ready-to-use <a href="https://kafka.apache.org/documentation/#connect_transforms">Single Message Transform</a> (SMT) that builds on the Outbox pattern to propagate data change events using Debezium and Kafka.
Please see the <a href="https://debezium.io/documentation/reference/1.1/configuration/outbox-event-router.html">documentation</a> for details on how to use this transformation.</p>
</div>
<div class="paragraph">
<p><!-- more --></p>
</div>
<div class="sect1">
<h2 id="going-supersonic-with-quarkus">Going Supersonic with Quarkus!</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://www.quarkus.io">Quarkus</a> is a Kubernetes Native Java framework that is tailored for GraalVM and HotSpot using the <em>best-of-breed</em> Java technologies and standards.
Quarkus aims to offer developers a unified reactive and imperative programming model to address a wide range of application architectures.</p>
</div>
<div class="paragraph">
<p>So what does all this mean exactly in laymen&#8217;s terms?</p>
</div>
<div class="paragraph">
<p>In short, the Debezium community can now leverage the Outbox pattern in a Quarkus-based application using a ready-to-use extension that works in parallel with your Debezium connector to emit change data events.
The Debezium Outbox extension for Quarkus can be used in both JVM or Native image modes in Quarkus.</p>
</div>
<div class="sect2">
<h3 id="how-to-get-it">How to get it?</h3>
<div class="paragraph">
<p>Currently the dependency must be manually added to your Quarkus application&#8217;s <code>pom.xml</code> as shown below.
There are plans to make this extension available in the Quarkus extension catalogue as well as via Quarkus' Maven plugin in a future release.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.debezium.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;debezium-quarkus-outbox&lt;/artifactId&gt;
  &lt;version&gt;1.1.0.Alpha1&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>At the time of this blog, the extension was released as <em>1.1.0.Alpha1</em>.<br>
A newer version of the extension may be available, see <a href="/releases/">Releases</a> for details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="using-the-extension">Using the extension</h3>
<div class="paragraph">
<p>The Debezium Outbox extension uses the Observer pattern to monitor when the user application emits an object that implements the <code>io.debezium.outbox.quarkus.ExportedEvent</code> interface.
This allows the Quarkus application behavior to be completely decoupled from that of the extension.</p>
</div>
<div class="paragraph">
<p>Lets walk through a simple example where a service is responsible for storing newly created orders and then emits an event that could be used to notify other interested services that an order has been created.</p>
</div>
<div class="paragraph">
<p>So to get started, we&#8217;ll begin by first implementing <code>OrderCreatedEvent</code>, an implementation of <code>ExportedEvent</code>.
This event is used to signal when an <code>Order</code> has been saved by the <code>OrderService</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class OrderCreatedEvent implements ExportedEvent&lt;String, JsonNode&gt; {
    private final long orderId;
    private final JsonNode payload;
    private final Instant created;

    public OrderCreatedEvent(Instant createdAt, Order order) {
        this.orderId = order.getId();
        this.payload = convertOrderToJsonNode(order);
        this.created = createdAt;
    }

    @Override
    public String getAggregateId() {
        return String.valueOf(orderId);
    }

    @Override
    public String getAggregateType() {
        return "Order";
    }

    @Override
    public JsonNode getPayload() {
        return payload;
    }

    @Override
    public String getType() {
        return "OrderCreated";
    }

    @Override
    public Instant getTimestamp() {
        return created;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ExportedEvent</code> interface is the contract that defines how a Quarkus application is to provide the extension with the data to persist to the outbox database table.
This contract exposes several different values discussed below:</p>
</div>
<div class="sect3">
<h4 id="aggregate-id">Aggregate Id</h4>
<div class="paragraph">
<p>The aggregate id is used when emitting messages to Kafka as the message key to preserve message order.
In this example, the <code>OrderCreatedEvent</code> returns the order identifier.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>ExportedEvent</code> interface is parameterized and the first argument of the parameter argument list allows the application to specify the return data type for the aggregate id.
While this example uses a <code>String</code>, the value returned can be any persistable object type.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="aggregate-type">Aggregate Type</h4>
<div class="paragraph">
<p>The aggregate type is a string-based value that is used to append to the Kafka topic name and also assists in routing of the given message inside the Outbox Event Router SMT.
In this example, we use <code>Order</code> and when using the default configuration of the SMT, messages would be found in the <code>outbox.event.Order</code> topic.
Please see the <code>route.topic.replacement</code> in the <a href="documentation/reference/1.1/configuration/outbox-event-router.html#configuration-options">SMT configuration options</a> for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="type">Type</h4>
<div class="paragraph">
<p>The message type is a string value that is emitted in the Kafka message&#8217;s envelope.
In this example, the value in the message envelope would be <code>OrderCreated</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="timestamp">Timestamp</h4>
<div class="paragraph">
<p>By default, the Outbox Event Router SMT emits outbox events using the current timestamp when processing records but this may not always be sufficient for every use case.
This field allows the source application to specify an <code>Instant</code> that can then be configured through the <a href="documentation/reference/1.1/configuration/outbox-event-router.html#configuration-options">SMT configuration options</a> to be used as the Kafka message timestamp instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="payload">Payload</h4>
<div class="paragraph">
<p>The payload is the message content or value and is what is consumed by consumers of the Kafka topic.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>ExportedEvent</code> interface is parameterized and the second argument of the parameter argument list allows the application to specify the return data type for the payload.
While this example uses a <code>JsonNode</code> to store a JSON representation of the <code>Order</code>, the payload can be any persistable object type.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If multiple implementations of <code>ExportedEvent</code> exist in a Quarkus application, they must all use the same signature.
If different signatures are required, the code should be split into different Quarkus applications because all <code>ExportedEvent</code> implementations will be stored in the same database outbox table for a given Quarkus application.
We are currently investigating alternatives to loosen this restriction in a future release to allow multiple variants within the same application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By itself, this <code>OrderCreatedEvent</code> does nothing on its own.</p>
</div>
<div class="paragraph">
<p>Next we want to implement an application component that is responsible for persisting the order to the database and then to emit the <code>OrderCreatedEvent</code> event.
The <code>OrderService</code> class below uses JPA to persist the <code>Order</code> entity and then <code>javax.enterprise.event.Event&lt;T&gt;</code> to notify the outbox extension.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ApplicationScoped
public class OrderService {
    @Inject
    EntityManager entityManager;

    @Inject
    Event&lt;ExportedEvent&lt;String, JsonNode&gt;&gt; event;

    @Transactional
    public Order addOrder(Order order) {
        entityManager.persist(order);
        event.fire(new OrderCreatedEvent(Instant.now(), order));
        return order;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before starting the application, certain configuration settings must be specified in <code>application.properties</code>.
An example configuration might look like the following where we specify the database to connect to as well as how the persistence provider, Hibernate, is to operate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">quarkus.datasource.driver=org.postgresql.Driver
quarkus.datasource.url=jdbc:postgresql://order-db:5432/orderdb?currentSchema=orders
quarkus.datasource.username=user
quarkus.datasource.password=password
quarkus.hibernate-orm.database.generation=update
quarkus.hibernate-orm.dialect=org.hibernate.dialect.PostgreSQLDialect
quarkus.hibernate-orm.log.sql=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>By starting the application with this configuration the outbox table <code>OutboxEvent</code> will be created in the <code>orders</code> schema of the the <code>order-db</code> database with the following layout:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">orderdb=# \d orders.outboxevent
                        Table "orders.outboxevent"
    Column     |            Type             | Collation | Nullable | Default
---------------+-----------------------------+-----------+----------+---------
 id            | uuid                        |           | not null |
 aggregatetype | character varying(255)      |           | not null |
 aggregateid   | character varying(255)      |           | not null |
 type          | character varying(255)      |           | not null |
 timestamp     | timestamp without time zone |           | not null |
 payload       | character varying(8000)     |           |          |
Indexes:
    "outboxevent_pkey" PRIMARY KEY, btree (id)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When using <code>JsonNode</code> as the payload return type, the extension uses a JPA attribute converter to store the contents as a string in the database.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Should the table or column names not fit your naming convention, they can be customized with several <a href="/documentation/reference/1.1/integrations/outbox.html#_build_time_configuration_options">build-time configuration options</a>.
For example, if you wanted the table to be named <code>outbox</code> rather than <code>outboxevent</code> add the following line to the <code>application.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">quarkus.debezium-outbox.table-name=outbox</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you enabled SQL logging or check the row count of the outbox table, you might find it unusual that after saving the order that a record is inserted into the outbox table but then is immediately deleted.
This is the default behavior since rows are not required to be retained for Debezium to pick up the change.</p>
</div>
<div class="paragraph">
<p>If row retention is required, this can be configured using a <a href="/documentation/reference/1.1/integrations/outbox.html#_runtime_configuration_options">run-time configuration option</a>.
In order to enable row retention, add the following configuration to the <code>application.properties</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">quarkus.debezium-outbox.remove-after-insert=false</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-the-connector">Setting up the connector</h3>
<div class="paragraph">
<p>Up to this point we&#8217;ve covered how to configure and use the extension in a Quarkus application to save events into the outbox database table.
The last step is to configure the Debezium connector to monitor the outbox and emit those records to Kafka.</p>
</div>
<div class="paragraph">
<p>We&#8217;re going to use the following connector configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "connector.class": "io.debezium.connector.postgresql.PostgresConnector",
  "tasks.max": "1",
  "database.hostname": "order-db",
  "database.port": "5432",
  "database.user": "user",
  "database.password": "password",
  "database.dbname": "orderdb",
  "database.server.name": "dbserver1",
  "schema.whitelist" : "orders",
  "table.whitelist": "orders.outboxevent",
  "tombstones.on.delete": "false",
  "transforms": "outbox",
  "transforms.outbox.type" : "io.debezium.transforms.outbox.EventRouter",
  "transforms.outbox.route.topic.replacement": "${routedByValue}.events",
  "transforms.outbox.table.field.event.timestamp": "timestamp",
  "transforms.outbox.table.fields.additional.placement": "type:header:eventType"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A vast majority of this is standard Debezium connector configuration, but what is important are the last several lines that begin with <strong>transforms</strong>.
These are configuration options that are used by Kafka Connect to configure and call the Outbox Event Router SMT.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This configuration uses a custom <code>route.topic.replacement</code> configuration property.
This setting will instead route <code>OrderCreatedEvent</code> rows from the outbox to the <code>Order.events</code> topic rather than the default <code>outbox.events.Order</code> topic.</p>
</div>
<div class="paragraph">
<p>This configuration also specifies the <code>field.event.timestamp</code> configuration property.
This setting will instead populate the Kafka message time from the <code>timestamp</code> field in the outbox database table rather than the current timestamp when processing the row.</p>
</div>
<div class="paragraph">
<p>Please see <a href="/documentation/reference/1.1/configuration/outbox-event-router.html#configuration-options">Outbox Event Router Configuration Options</a> for details on how to configure the SMT.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the connector is running, the <code>Order.events</code> topic will be populated with messages from the outbox table.
The following JSON example represents an <code>Order</code> which gets saved by the <code>OrderService</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "customerId" : "123",
    "orderDate" : "2019-01-31T12:13:01",
    "lineItems" : [
        {
            "item" : "Debezium in Action",
            "quantity" : 2,
            "totalPrice" : 39.98
        },
        {
            "item" : "Debezium for Dummies",
            "quantity" : 1,
            "totalPrice" : 29.99
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When examining the <code>Order.events</code> topic, the event emitted will look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "key": "1",
  "headers": "id=cc74eac7-176b-44e7-8bda-413a5088ca66,eventType=OrderCreated"
}
"{\"id\":1,\"customerId\":123,\"orderDate\":\"2019-01-31T12:13:01\",\"lineItems\":[{\"id\":1,\"item\":\"Debezium in Action\",\"quantity\":2,\"totalPrice\":39.98,\"status\":\"ENTERED\"},{\"id\":2,\"item\":\"Debezium for Dummies\",\"quantity\":1,\"totalPrice\":29.99,\"status\":\"ENTERED\"}]}"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="wrapping-up">Wrapping up</h3>
<div class="paragraph">
<p>It is really simple and easy to setup and use the Debezium Outbox extension.</p>
</div>
<div class="paragraph">
<p>We have a complete <a href="https://github.com/debezium/debezium-examples/tree/master/outbox">example</a> in our examples repository that uses the order service described here as well as a shipment service that consumes the events.
For more details on the extension, refer to the <a href="https://debezium.io/documentation/reference/1.1/integrations/outbox.html">Outbox Quarkus Extension</a> documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="future-plans">Future Plans</h3>
<div class="paragraph">
<p>The current implementation of the Debezium Outbox extension works quite well, but we acknowledge there is still room for improvement.
Some of the things we&#8217;ve already identified and have plans to include in future iterations of the extension are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Avro serialization support for event payload</p>
</li>
<li>
<p>Full outbox table column attribute control, e.g. definition, length, precision, scale, and converters.</p>
</li>
<li>
<p>Complete outbox table customization using a user-supplied entity class.</p>
</li>
<li>
<p>Allow varied signatures of <code>ExportedEvent</code> within a single application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We are currently tracking all future changes to this extension in <a href="https://issues.redhat.com/browse/DBZ-1711">DBZ-1711</a>.
As always we welcome any and all feedback, so feel free to let us know in that issue, on Gitter, or the mailing lists.</p>
</div>
</div>
</div>
</div></div>
    </div>
    
   
      
      
      <div class="well">
      <div class="row">
        <div class="col-md-8">
          <h2>Chris Cranford</h2>
          
          <p>
            <span class="bio-size"
              >Chris is a software engineer at Red Hat. He previously was a member of the Hibernate ORM team and now works on Debezium. He lives in North Carolina just a few hours from Red Hat towers.</span
            >
          </p>
          
          <p class="bio-size">
            
            
            <a href="https://github.com/naros">
              <i class="icon-github"></i>
            </a>
            &nbsp;
            
            
            <a href="https://www.linkedin.com/in/crancran">
              <i class="icon-linkedin"></i>
            </a>
            &nbsp;
            
          </p>
        </div>
        <div class="col-md-4">
          
          <img
            alt=""
            class="img-responsive pull-right portrait"
            src="/assets/images/ccranfor.jpg"
          />
          
        </div>
      </div>
    </div>
    

      <ul class="pager pager-blog">
        
          <li class="previous">
            <a href="/blog/2020/01/16/debezium-1-1-alpha1-released/" class="previous"> &laquo; Previous</a>
        </li>
                
        
        <li class="next"><a href="/blog/2020/02/10/event-sourcing-vs-cdc/">Next &raquo; </a></li>
        
      </ul>
    
    
    <div class="row">
      <div class="col-md-12">
        <hr>
        <h2>About Debezium</h2>
        <p>
          Debezium is an open source distributed platform that turns your existing databases into event streams,
          so applications can see and respond almost instantly to each committed row-level change in the databases.
          Debezium is built on top of <a href="http://kafka.apache.org/">Kafka</a> and provides <a href="http://kafka.apache.org/documentation.html#connect">Kafka Connect</a> compatible connectors that monitor specific database management systems.
          Debezium records the history of data changes in Kafka logs, so your application can be stopped and restarted at any time and can easily consume all of the events it missed while it was not running,
          ensuring that all events are processed correctly and completely.
          Debezium is <a href="/license/">open source</a> under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, Version 2.0</a>.
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <h2>Get involved</h2>
        <p>
          We hope you find Debezium interesting and useful, and want to give it a try.
          Follow us on Twitter <a href="https://twitter.com/debezium">@debezium</a>, <a href="https://gitter.im/debezium/user">chat with us on Gitter</a>,
          or join our <a href="https://groups.google.com/forum/#!forum/debezium">mailing list</a> to talk with the community.
          All of the code is open source <a href="https://github.com/debezium/">on GitHub</a>,
          so build the code locally and help us improve ours existing connectors and add even more connectors.
          If you find problems or have ideas how we can improve Debezium, please let us know or <a href="https://issues.redhat.com/projects/DBZ/issues/">log an issue</a>.
        </p>
      </div>
    </div>
    
    
      

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://debezium.io/blog/2020/01/22/outbox-quarkus-extension/';
      this.page.identifier = 'https://debezium.io/blog/2020/01/22/outbox-quarkus-extension/';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://Debezium.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

    
  </div>
</div>

        
      </div>
      <footer class="container">
  <div>
  <div class="row mr-0 ml-0">
    <div class="col-md-5 col-md-offset-1">
      <h4>Debezium</h4>
      <p>
        &#169; 2021 Debezium Community <br />
        <br />
        <i class="icon-fire"></i> Mixed with
        <a href="https://getbootstrap.com/">Bootstrap</a>, baked by
        <a href="https://jekyllrb.com/">Jekyll</a>. <br />
        <i class="icon-flag"></i> Website and docs licensed under
        <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
        <br />
        <i class="icon-flag-alt"></i> Code released under
        <a href="https://www.apache.org/licenses/LICENSE-2.0.html"
          >Apache License, v2.0</a
        >. <br />
        <i class="icon-file-alt"></i>
        <a
          href="https://www.redhat.com/legal/legal_statement.html"
          title="Terms"
          >Terms</a
        >
        |
        <a
          href="https://www.redhat.com/legal/privacy_statement.html"
          title="Privacy Policy"
          >Privacy</a
        >
      </p>
    </div>
    <div class="col-md-3">
      <h4>Documentation</h4>
      <ul class="list-unstyled">
        <li><a href="/documentation/reference/features.html" title="Features">Features</a></li>
        <li>
          <a href="documentation/reference/install.html" title="Install">Install</a>
        </li>
        <li>
          <a href="/documentation/reference/architecture.html" title="Architecture"
            >Architecture</a
          >
        </li>
        <li><a href="/documentation/faq/" title="FAQ">FAQ</a></li>
        <li>
          <a href="/community/contribute/" title="Contribute">Contribute</a>
        </li>
      </ul>
    </div>
    <div class="col-md-3">
      <h4>Connect</h4>
      <ul class="list-unstyled">
        <li><a href="/blog" title="Blog">Blog</a></li>
        <li>
          <a href="https://twitter.com/debezium" title="Twitter">Twitter</a>
        </li>
        <li><a href="https://github.com/debezium" title="GitHub">GitHub</a></li>
        <li><a href="https://gitter.im/debezium/user" title="Chat">Chat</a></li>
        <li>
          <a
            href="https://groups.google.com/forum/#!forum/debezium"
            title="Google Groups"
            >Google Groups</a
          >
        </li>
        <li>
          <a
            href="https://stackoverflow.com/questions/tagged/debezium"
            title="StackOverflow"
            >StackOverflow</a
          >
        </li>
      </ul>
    </div>
  </div>
</div>
</footer>
      <div class="container" id="companyfooter">
  <div class="redhatlogo">
    <a href="https://www.redhat.com/">
      <img
        src="/assets/images/Logo-Red_Hat-Sponsored_By-B-Standard-RGB.svg"
      />
    </a>
  </div>
</div>
<div class="text-center">env: production</div>
  </div>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-76464546-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-76464546-1');
</script>
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/vanilla-back-to-top.min.js"></script>
  <script>
    addBackToTop({
      scrollDuration: 400
    })
  </script>
</body>

</html>
